<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>JQuery FusionCharts Example</title>
    <script
      type="text/javascript"
      src="https://code.jquery.com/jquery-3.3.1.min.js"
    ></script>
    <script type="text/javascript" src="./fusioncharts.js"></script>
    <script type="text/javascript" src="./fusioncharts.charts.js"></script>
    <script type="text/javascript" src="./fusioncharts.timeseries.js"></script>
    <script
      type="text/javascript"
      src="https://unpkg.com/fusioncharts/themes/fusioncharts.theme.fusion.js"
    ></script>
    <script
      type="text/javascript"
      src="./fusioncharts.jqueryplugin.js"
    ></script>
  </head>
  <body>
    <div id="chart-container">FusionCharts will render here...</div>
    <button id="update">Update</button>
    <script type="text/javascript">
      const dataUrl =
        'https://s3.eu-central-1.amazonaws.com/fusion.store/ft/data/line-chart-with-time-axis-data.json';
      const schemaUrl =
        'https://s3.eu-central-1.amazonaws.com/fusion.store/ft/schema/line-chart-with-time-axis-schema.json';

      let jsonify = res => res.json();
      let dataFetch = fetch(dataUrl).then(jsonify);
      let schemaFetch = fetch(schemaUrl).then(jsonify);

      Promise.all([dataFetch, schemaFetch]).then(res => {
        var data = res[0];
        var schema = res[1];
        var dataStore = new FusionCharts.DataStore();
        var timeseriesConfig = {
          type: 'timeseries',
          width: '500',
          height: '300',
          dataFormat: 'json',
          dataSource: {
            data: dataStore.createDataTable(data, schema),
            yAxis: {
              plot: [{ value: 'Sales' }]
            },
            caption: {
              text: 'Online Sales of a SuperStore in the US'
            }
          }
        };
        $('document').ready(function() {
          $('#chart-container').insertFusionCharts(timeseriesConfig);
          $('#update').click(function() {
            let newDataSource = timeseriesConfig.dataSource;
            newDataSource.caption.text = 'Caption has been changed!';
            $('#chart-container').updateFusionCharts({
              dataSource: newDataSource,
              width: '600',
              height: '400'
            });
          });
        });
      });
    </script>
  </body>
</html>
